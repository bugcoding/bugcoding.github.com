<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="keep coding, keep moving..."><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Makefile初步-2</title><link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="author"><div class="author-name"><a href="/">bugcode's note</a></div><div class="about-me">思绪如风，来去匆匆。</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.jpg"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/bugcoding"></span><a href="https://github.com/bugcoding" target="_blank" title="https://github.com/bugcoding">https://github.com/bugcoding</a></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">Makefile初步-2</div><span class="date">2014年04月03日</span><span>   </span><span class="tags"><a class="tag-link" href="/tags/Linux/">Linux</a></span><div class="content"><p>接上文，假如有如下一个Makefile其中一部分是这样的：</p>
<a id="more"></a>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obj: utils.o display.o edit.o interface.o save.o</span><br><span class="line">    gcc –std=c99 –g utils.o display.o edit.o interface.o save.o -o main</span><br></pre></td></tr></table></figure>
<p>而且obj的依赖还会不停的变动，增加或者减少，更可能的是这一组依赖还会出现在文件中的其他地方，命令规则的参数也可能有很长一串，那想想，每次都要写这么多的文件名/命令字符串，的确是个很麻烦的事，而且还容易出错，更不容易查错。make已经为我们想到了替代方式，就是用一个变量来替代这一组长长的文件名列表/参数选项列表，在make规则中只使用这个变量来代替那一组文件列表，这样既能减少错误，还能减少工作量。</p>
<p>通常使用变量的使用是<strong>OBJ = XXOO</strong> OOXX或者<strong>FLAG = ZZZZ</strong>等形式，在引用的时候使用<strong>$</strong>(美元符)加以引用，如$(OBJ)，这样儿在引用的时候，就像C语言的宏替换类似，变量所代表的名称列表就会被展开到，对应的位置，如上面的例子就可以写成：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OBJ = utils.o display.o edit.o interface.o save.o</span><br><span class="line">CFLAGS = -std=c99</span><br><span class="line">    CC = gcc</span><br><span class="line">main: main.c $(OBJ)</span><br><span class="line">    $(CC) $(FLAGS) main.c –o main</span><br><span class="line">    .PHONY:clean</span><br><span class="line">    clean:</span><br><span class="line">    rm $(OBJ) main</span><br></pre></td></tr></table></figure>
<p>这样就可以避免多处引用的时候出现写错的情况。</p>
<p>关于简单的自动推导，就是make工具有一个默认规则，给出目标和依赖，如果没有生成的命令，那么就会默认按照<strong>cc –c XXX.c –o XXX.o</strong>的形式，自动生成对应的目标文件。那么，在<a href="http://bugcode.net/2014/03/31/Makefile%E5%88%9D%E6%AD%A5-1/">Makefile初步-1</a>中所写的文件，就可以变成这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">OBJ = utils.o display.o</span><br><span class="line"></span><br><span class="line">main: main.c $(OBJ)</span><br><span class="line">    utils.o: utils.h utils.c</span><br><span class="line">    display.o: display.c display.h</span><br><span class="line"></span><br><span class="line">    .PHONY: clean</span><br><span class="line">    clean:</span><br><span class="line">    rm -f $(OBJ) main</span><br></pre></td></tr></table></figure>
<p>虽然能省不少打字的工夫，但是还是写明生成规则比较好，因为有助于后期的维护。这就是Makefile中简单的变量和自动推导规则。</p>
</div></section></div><div class="container"><ul class="nav"><li>上一篇：<a href="/2014/05/01/Makefile初步-3.html">Makefile初步-3</a></li><li>下一篇：<a href="/2014/03/31/Makefile初步-1.html">Makefile初步-1</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><center class="span">2014-2018 bugcode.</center></div></footer><script src="/script/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/script/index.js"></script><script src="/script/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/script/index.js"></script><script src="/script/post.js"></script></body></html>