<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="keep coding, keep moving..."><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>C99标准笔记</title><link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="author"><div class="author-name"><a href="/">bugcode's note</a></div><div class="about-me">思绪如风，来去匆匆。</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.jpg"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/bugcoding"></span><a href="https://github.com/bugcoding" target="_blank" title="https://github.com/bugcoding">https://github.com/bugcoding</a></li><li class="social-item"><span class="label"><img src="/images/socials/rss.svg" alt="https://bugcode.net/atom.xml"></span><a href="https://bugcode.net/atom.xml" target="_blank" title="https://bugcode.net/atom.xml">https://bugcode.net/atom.xml</a></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">C99标准笔记</div><span class="date">2014年06月16日</span><span>   </span><span class="tags"><a class="tag-link" href="/tags/C/">C</a></span><div class="content"><p>c99标准也就是C语言在99年修订的最新标准，想一下99年我还在上小学-_!，虽然只是一个c99某些新特性的笔记，尽量写清楚，做笔记的同时，也可以对大家有帮助。 </p>
<a id="more"></a>
<ol>
<li><p>个人感觉最常用的莫过于别的语言都已经有的，for循环内变量的初始化，如在c99之前ansi c标准的for循环代码都是这样来写：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; val; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// some code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而c99标准里可以将变量放入循环体当中，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; val; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// some code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之所以放在第一位是感觉这个太常用了。</p>
</li>
<li><p>双斜线形式的注释，c99之前的的注释都是 /<em> code comments </em>/，c99标准加入了//这种c++的形式的单行注释。</p>
</li>
<li><p>变长数组，c99之前的数组长度是必须固定的，想要变长就需要使用malloc动态分配动态长度的内存，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *vla = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * length);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">&#123;</span><br><span class="line">	vla[i] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用完之后free(vla)</span></span><br></pre></td></tr></table></figure>
<p>有了c99标准就可以直接在使用数组的时候，定义一个数组长度是变量的数组，如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">array</span>[i] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 只限于在创建时动态指定，后期不可随意变动长度</span></span><br></pre></td></tr></table></figure>
<p>这样就定义了一个长度为length的数组，length可以手动指定。但是这种变长数组的意思是指在确定数组长度的时候可以动态的（由变量来指定），并不是指在创建数组之后可以随意变动数组的长度。</p>
</li>
<li><p>指定域的初始化，也就是c99中可以对结构体或者数组进行某一部分的初始化，或者是某个成员的初始化。如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> fir;</span><br><span class="line">    <span class="keyword">long</span> sec;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Test</span> *<span class="title">m_ptr</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//只针对数组中的0，5，8三个下标位置进行初始化，其他都为0</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">10</span>] = &#123;[<span class="number">0</span>] = <span class="number">1</span>, [<span class="number">5</span>] = <span class="number">10</span>, [<span class="number">8</span>] = <span class="number">12</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"array[%d] == %d\n"</span>, i, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//只针对后二个成员进行初始化，第一个默认初始化为0</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Test</span> <span class="title">t</span> = &#123;</span>.sec = <span class="number">100L</span>, .m_ptr = <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, t.fir);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可伸缩型的数组成员，这个在gcc中早就有对应的扩展，常见的写法就是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fixible</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">int</span> flag;</span><br><span class="line">    <span class="keyword">char</span> ext[<span class="number">0</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样儿的好处就是不用指定ext的最大范围，而是根据需要，灵活指定ext所需要的长度。c99把这个功能加了进来。一个常见的例子就是统计每一行文本的长度与内容，长度未知的情况，可以这么写：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lines_counter</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> line_length;</span><br><span class="line">    <span class="keyword">char</span> content[];<span class="comment">//必须放在成员最后</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_content</span><span class="params">(<span class="keyword">int</span> line_len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">lines_counter</span> *<span class="title">lc</span> = (<span class="title">struct</span> <span class="title">lines_counter</span> *)</span></span><br><span class="line"><span class="class">        <span class="title">malloc</span>(<span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">lines_counter</span>) + <span class="title">line_len</span> + 1);</span></span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">    lc-&gt;line_length = line_len;</span><br><span class="line">    <span class="comment">//XXX</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样针对不同长度的文本，都会分配正合适大小的结构来存储长度与内容。</p>
</li>
<li><p><strong>bool</strong>类型，c99加入了一个stdbool头文件，里面定义了bool的false与true。这个不用多说，#include &lt;stdbool.h&gt;, 就可以用false与true了。不用自己再define或者enum了。</p>
</li>
<li><p>混合声明，之前的c语言都是一堆变量都在函数开头一股脑的定义好，现在有了c99标准，就可以随时定义变量并使用而不必全部写在开头了。</p>
</li>
<li><p><strong>func</strong>内置常量，c99加入了这个常量，义指<strong>func</strong>所在行所处的函数名。这个对于调试还是相当有用的。可以直接通过调试语句配置<strong>LINE</strong>打印出log所在的函数。</p>
</li>
<li><p>上面提到了调试语句，就不得不提另一个比较好用的，变参宏，c99加入变参宏，可以让程序员很自由写一些带变参的调试宏，如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG(format,...) \</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[Debug]: "</span> format <span class="string">" -- %s -- %d \n"</span>,##__VA_ARGS__,__func__,__LINE__)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DEBUG(<span class="string">"%d == %s"</span>, <span class="number">10</span>, <span class="string">"debug print"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然变参部分也可以为空串，为空串那么##<strong>VA_ARGS</strong>就会直接展开成空的字符串，也就是完全可以DEBUG(); 这样来调用这个调试语句，这只是一个示例，你可以将调试语句写得更精细</p>
</li>
<li><p>复合常量，也就是在c99标准里的c可以定义一个匿名的结构体或者数组，常用的地方应该就是构造一个临时变量，传给函数做参数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rect</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Point</span> *<span class="title">point</span>;</span></span><br><span class="line">    <span class="keyword">int</span> wid;</span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_func</span><span class="params">(<span class="keyword">int</span> *<span class="built_in">array</span>, <span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_func2</span><span class="params">(struct Rect *rect)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"point &#123;%d, %d&#125; %d -- %d\n"</span>,rect-&gt;point-&gt;x, rect-&gt;point-&gt;y, rect-&gt;wid, rect-&gt;len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    test_func((<span class="keyword">int</span> [])&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>&#125;, <span class="number">4</span>);</span><br><span class="line">    test_func2(&amp;(struct Rect)&#123;.point = &amp;(struct Point)&#123;.x = <span class="number">10</span>, .y = <span class="number">10</span>&#125;, .wid = <span class="number">50</span>, .len = <span class="number">70</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样在实际项目中可能很少这样来用，但是对于测试代码应该很有帮助，不用再定义一个变量初始化好了再传入参数，直接使用复合变量直接传入就可以了，节省了一步操作。针对团队项目来说，应该是写清楚明了更有助于大家开发。</p>
</li>
<li><p><strong>long long</strong>类型，没错，就是c99才开始支持的，scanf和printf的格式化字符串ll或者LL也是c99才开始支持的。同时引用了float，double complex复数，增加了相关复数运算，都在&lt;complex.h&gt;头文件中。</p>
</li>
<li><p><strong>inline</strong>关键字，c99为c引入了内联函数，普通的宏只是单纯的字符串展开与替换，内联函数可以进行一些参数检查等相关的一些宏做不到的事。在本文件中使用刚需要声明为<em>static inline</em>，如果需要外部使用则需要在声明中<em>extern inline</em>，否则会出现编译不过的情况。</p>
</li>
</ol>
</div></section></div><div class="container"><ul class="nav"><li>上一篇：<a href="/2015/01/07/Windows下编译Clang.html">Windows下编译Clang</a></li><li>下一篇：<a href="/2014/05/01/Makefile初步-3.html">Makefile初步-3</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><center class="span">2014-2018 bugcode.</center></div></footer><script src="/script/jquery.min.js"></script><script src="/script/index.js"></script><script src="/script/jquery.min.js"></script><script src="/script/index.js"></script><script src="/script/post.js"></script></body></html>