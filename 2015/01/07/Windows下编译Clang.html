<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="keep coding, keep moving..."><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Windows下编译Clang</title><link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="author"><div class="author-name"><a href="/">bugcode's note</a></div><div class="about-me">思绪如风，来去匆匆。</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.jpg"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/bugcoding"></span><a href="https://github.com/bugcoding" target="_blank" title="https://github.com/bugcoding">https://github.com/bugcoding</a></li><li class="social-item"><span class="label"><img src="/images/socials/rss.svg" alt="https://bugcode.net/atom.xml"></span><a href="https://bugcode.net/atom.xml" target="_blank" title="https://bugcode.net/atom.xml">https://bugcode.net/atom.xml</a></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">Windows下编译Clang</div><span class="date">2015年01月07日</span><span>   </span><span class="tags"><a class="tag-link" href="/tags/Windows/">Windows</a></span><div class="content"><p>网上最近一直在说Clang这个编译器，说FreeBSD已完全使用Clang为默认编译器，Mac下也是这个编译器，“据说”编译速度比Gcc快出很多，生成出来的可执行文件也比Gcc生成的要小那么几个KB，还有错误提示也要友好很多，更还有各方“大家”对此嗤之以鼻。但是不管如何，做为一个喜欢瞎折腾的码农，不管各个大家是怎么说，自己一定要上手试试的。因为在Windows下没有Clang的二进制包，本着自己动手丰衣足食的原则，决定自己构建一个尝尝鲜（虽然这个’鲜’已然过去很久了）， 其实构建过程很简单，官网上的getting started说得很明确了，这里也只是再用中文重复一下：</p>
<a id="more"></a>
<ol>
<li>svn的客户端，大多数都是直接使用TortoiseSVN，也就是那个“小乌龟”，用来check代码的，当然也可以直接去下source包。</li>
<li>cmake，一个跨平台的makefile生成工具，可以生成不同平台的各种makefile或者project文件。</li>
<li>vs2008或者vs2010，这个应该不用多说了，用windows的都知道。</li>
</ol>
<p>三个工具安装好，并确保cmake的bin目录在path中，就可以开工了。</p>
<p>新建一个文件夹来放由svn检出的代码，比如d:/clang_llvm，之后用TortoiseSVN首先检出<a href="http://llvm.org/svn/llvm-project/llvm/trunk" target="_blank" rel="noopener">llvm</a>的代码到llvm文件夹，然后再检出<a href="http://llvm.org/svn/llvm-project/cfe/trunk" target="_blank" rel="noopener">clang</a>的代码到clang文件夹，再将clang文件夹全部移动到llvm下的tools文件夹下(TortoiseSVN)直接嵌入到右键菜单中，直接在clang_llvm文件夹中check out，填入链接和本地目录，OK即可）。完成后，回到clang_llvm文件夹下，此时文件夹中只有llvm目录，在clang_llvm下新建文件夹build。控制台进入到clang_llvm下的build目录下，执行如下命令：</p>
<blockquote>
<p>如果是vs2008，则是：camke –G “Visual Studio 9 2008” ..\llvm</p>
<p>如果是vs2010，则是：cmake –G “Visual Studio 10” ..\llvm</p>
</blockquote>
<p>如果运气不错，执行完毕后，生成LLVM.sln。使用vs打开这个解决方案。选择ALL_BUILD构建，漫长的等待…</p>
<p>完成后就可以在build/bin/Debug或者build/bin/Release文件下看到对应的类似clang.exe这样的生成文件了。将可执行文件所在目录加入path，就可以写一个test.c来测试一个clang了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang –Wall test.c –o test</span><br></pre></td></tr></table></figure>
<p>下面是一个测试的例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">     &#123;</span><br><span class="line">           <span class="keyword">if</span> (i == <span class="number">2</span>)</span><br><span class="line">           &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &amp;i);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, i + <span class="number">1</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc –Wall –std=c99 test.c –o test_gcc.exe</span><br><span class="line">clang –Wall –std=c99 test.c –o test_clang.exe</span><br></pre></td></tr></table></figure>
<p>编译均通过。下面是生成的可执行文件大小截图：</p>
<p><img src="/chapimages/generate_size.png" alt=""></p>
<p>看起来clang生成的可执行文件的确比gcc生成的可执行文件要小，当然，这么一个小例子也说明不了什么。继续……</p>
<p>现在将源代码改出二个错误[一个算做逻辑错误，一个语法错误]，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">     &#123;</span><br><span class="line">           <span class="keyword">if</span> (i = <span class="number">2</span>)<span class="comment">//这里改为赋值</span></span><br><span class="line">           &#123;</span><br><span class="line">               <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &amp;i);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, i + <span class="number">1</span>)<span class="comment">//这里故意去掉了分号</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先看gcc的错误和警告提示截图[编译命令同上]：</p>
<p><img src="/chapimages/gcc_error.png" alt=""></p>
<p>gcc在第7行，也就是注释的第1行，给出了一个警告建议，第12行，也就是大括号前给出了一个语法错误提示。</p>
<p>下面再看clang的警告和错误提示截图[编译命令同上]：</p>
<p><img src="/chapimages/clang_error.png" alt=""></p>
<p>clang这里给出的语法错误就比较直观了，直接能看到哪里出现了错误，定位到具体位置，而且针对“逻辑错误”，给出修改建议。当然这也只是一个小小的错误，也说明不了什么，码农的尝鲜clang就到此了^_*。</p>
</div></section></div><div class="container"><ul class="nav"><li>上一篇：<a href="/2015/02/15/快速排序图解.html">快速排序图解</a></li><li>下一篇：<a href="/2014/06/16/C99标准笔记.html">C99标准笔记</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><center class="span">2014-2018 bugcode.</center></div></footer><script src="/script/jquery.min.js"></script><script src="/script/index.js"></script><script src="/script/jquery.min.js"></script><script src="/script/index.js"></script><script src="/script/post.js"></script></body></html>