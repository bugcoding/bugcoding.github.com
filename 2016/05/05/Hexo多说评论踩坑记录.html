<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="keep coding, keep moving..."><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Hexo多说评论踩坑记录</title><link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="author"><div class="author-name"><a href="/">bugcode's note</a></div><div class="about-me">keep coding, keep moving...</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li><li><a href="/atom.xml">RSS</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.jpg"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/bugcoding"></span><a href="https://github.com/bugcoding" target="_blank" title="https://github.com/bugcoding">https://github.com/bugcoding</a></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">Hexo多说评论踩坑记录</div><span class="date">2016年05月05日</span><span>   </span><span class="tags"><a class="tag-link" href="/tags/Hexo/">Hexo</a></span><div class="content"><p><a href="https://github.com/forsigner/fexo" target="_blank" rel="noopener"><strong>Fexo</strong></a>的主题的评论数量显示的Hexo默认的评论系统disqus，国内还是用多说的多一些，Fexo主题集成了多说插件(其实就是内嵌的一段js代码)，但是并不是用的这个路径下的themes/fexo/layout/_partial/duoshuo.ejs而包含的component中的duoshuo.ejs，对web前端不了解，尝试修改了一下，因为查看多说的官方文档的时候，说评论数依据的是data-thread-key（标识文章的唯一ID），一个样式表中的class的名字，而Fexo真正包含的那个duoshuo.ejs并没有设置data-thread-key的值，所以手动改一下，我改成了page.path，文章的路径用来做唯一key(年月日加文章名，重复的机会不太大)，这样重新hexo clean再hexo g，就能生成唯一data-thread-key值了。</p>
<a id="more"></a>
<p>Fexo默认是评论次数是显示的disqus的，没有对多说进行处理，这里改动一下themes/fexo/layout/_partial/路径下的article.ejs的20行左右，将其自定义的disqus的评论数改为多说的评论数量显示，根据多说文档，加入一个带data-thread-key的class的span标签即可:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (theme.duoshuo_shortname &amp;&amp; theme.url)&#123; %&gt;</span><br><span class="line">   &lt;span&gt;</span><br><span class="line">      &lt;i class=&quot;icon-comment&quot;&gt;&lt;/i&gt;</span><br><span class="line">      &lt;a href=&quot;&lt;%= theme.url + url_for(page.path) + &apos;#ds-thread&apos; %&gt;&quot;&gt;&lt;span class=&quot;ds-thread-count&quot; data-thread-key=&quot;&lt;%= page.path %&gt;&quot; data-count-type=&quot;comments&quot;&gt;&lt;/span&gt;&lt;/a&gt;</span><br><span class="line">   &lt;/span&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>
<p>还有一个需要注意的是，这里的data-thread-key与刚才设置的data-thread-key要完全一致(针对每篇文章)，同时在主题的_config.yml中定义的duoshuo_shortname要与申请的多说二级域名的完全一致，不然也会导致评论数不正确，可以先创建一个简单的md生成一个页面，然后回复一个评论，再去多说的管理后台去看对应的data-thread-key是否正确，只有key和short完全一致，对应的文章才能获取正确的评论数。</p>
<p>踩坑完毕！</p>
</div></section></div><div class="container"><ul class="nav"><li>上一篇：<a href="/2016/05/05/SwiftNote-7.html">SwiftNote-7</a></li><li>下一篇：<a href="/2016/05/03/zsh-iTerm2折腾记录.html">zsh+iTerm2折腾记录</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><center class="span">2014-2018 bugcode.</center></div></footer><script src="/script/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/script/index.js"></script><script src="/script/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/script/index.js"></script><script src="/script/post.js"></script></body></html>