<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="keep coding, keep moving..."><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>CoffeeScript Note</title><link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="author"><div class="author-name"><a href="/">bugcode's note</a></div><div class="about-me">思绪如风，来去匆匆。</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.jpg"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/bugcoding"></span><a href="https://github.com/bugcoding" target="_blank" title="https://github.com/bugcoding">https://github.com/bugcoding</a></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">CoffeeScript Note</div><span class="date">2017年06月30日</span><span>   </span><span class="tags"><a class="tag-link" href="/tags/Javascript/">Javascript</a></span><div class="content"><p>CoffeeScript就是JavaScript的语法糖，写起来效率更高，也去掉了一些晦涩的语法，这里记录其简单用法。</p>
<a id="more"></a>
<ol>
<li><p>空格解析表达式， 小括号部分情况可选</p>
<p>使用空格和缩进区分表达式与语句的块级关系</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">10</span></span><br><span class="line"><span class="comment"># if语句不需要大括号进行块级代码分隔，只需要缩进即可</span></span><br><span class="line"><span class="keyword">if</span> x &gt; <span class="number">3</span></span><br><span class="line">    call_function x   <span class="comment"># 此处可以不加括号，直接使用空格</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>-&gt; 代替function</p>
<p>使用<code>-&gt;</code>代替function关键字</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function_name: <span class="function"><span class="params">(param1, param2)</span> -&gt;</span></span><br><span class="line">    function_body</span><br></pre></td></tr></table></figure>
</li>
<li><p>#{num} 字符串插值</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">number = <span class="number">10</span></span><br><span class="line"><span class="built_in">console</span>.log <span class="string">"The number is <span class="subst">#&#123;number&#125;</span>"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>heredoc  首尾 “”” here document “””</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">block_str = <span class="string">"""</span></span><br><span class="line"><span class="string">This is block string</span></span><br><span class="line"><span class="string">contains all whitespace and enter character</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="built_in">console</span>.log block_str</span><br></pre></td></tr></table></figure>
</li>
<li><p># 单选注释   ### 块注释 ###</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># single line comments</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">block comments</span></span><br><span class="line"><span class="comment">blah blah...</span></span><br><span class="line"><span class="comment">###</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>?= 存在赋值，即对应左侧变量不存在，则赋值给不存在的变量</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x ?= <span class="number">3</span></span><br><span class="line"><span class="comment"># 等同于</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> x</span><br><span class="line">    x = <span class="number">3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>存在操作  variable?，使用前会对variable进行判定是否为空操作</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member?.call_func() <span class="comment"># member 存在才会继续调用call_func()函数</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>操作符别名  is not  isnt  not and or </p>
<p>coffeescript定义一堆常规操作符的英文对应别名</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> x <span class="keyword">is</span> <span class="number">10</span></span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"x === 10"</span>  <span class="comment"># is即是 === 的别名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>if / unless   内联写法，即判定与</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func: <span class="function"><span class="params">(status_code)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"succeed"</span> <span class="keyword">if</span> status_code <span class="keyword">is</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>函数默认参数值 </p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func: <span class="function"><span class="params">(param1, default_param = <span class="number">0.5</span>)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">if</span> default_param <span class="keyword">isnt</span> <span class="number">0.5</span></span><br><span class="line">        <span class="built_in">console</span>.log <span class="string">"...."</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不定长参数 … 可在参数表任意位置</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func: <span class="function"><span class="params">(param1, var_param...)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> var_param</span><br><span class="line">        <span class="built_in">console</span>.log var</span><br></pre></td></tr></table></figure>
</li>
<li><p>交换赋值  [x, y] = [y, x]</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">10</span></span><br><span class="line">y = <span class="number">100</span></span><br><span class="line">[x, y] = [y, x] <span class="comment"># 无需使用第三个中间变量</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>区间  [1 .. 10]  [1 … 10]， 开区间与闭区间的区别</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1.</span><span class="number">.10</span>] <span class="comment"># 1-10</span></span><br><span class="line">    <span class="built_in">console</span>.log i</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1.</span>.<span class="number">.10</span>] <span class="comment"># 1-9</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>数组 array = [1, 2, 3, 4]</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义数组</span></span><br><span class="line">array = []</span><br><span class="line">array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="comment"># 数组截取</span></span><br><span class="line">slice_array = array[<span class="number">2.</span><span class="number">.5</span>] <span class="comment"># 3 4 5 6</span></span><br><span class="line"><span class="comment"># 数组插入数值</span></span><br><span class="line">insert_array = array[<span class="number">3.</span>.<span class="number">-1</span>] = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>] <span class="comment"># 1, 2, 3, 10, 11, 12, 4, 5, 6</span></span><br><span class="line"><span class="comment"># 遍历</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> array <span class="keyword">by</span> <span class="number">2</span></span><br><span class="line">    <span class="built_in">console</span>.log v   <span class="comment"># 间隔2个</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> array <span class="keyword">by</span> <span class="number">-1</span></span><br><span class="line">    <span class="built_in">console</span>.log v   <span class="comment"># 从后向前</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>map map = {key: value}</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义map</span></span><br><span class="line">map = &#123;&#125;</span><br><span class="line">map = &#123;<span class="string">"LiLei"</span>: <span class="number">18</span>, <span class="string">"HanMeiMei"</span>: <span class="number">22</span>&#125;</span><br><span class="line">map = </span><br><span class="line">	<span class="string">"key1"</span>: <span class="string">"value1"</span></span><br><span class="line">    <span class="string">"key2"</span>: <span class="string">"value2"</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 迭代map，map迭代不可以使用by关键字</span></span><br><span class="line"><span class="keyword">for</span> key, val <span class="keyword">of</span> map</span><br><span class="line">    <span class="built_in">console</span>.log key + <span class="string">" -&gt; "</span> + val</span><br></pre></td></tr></table></figure>
</li>
<li><p>when关键字，针对迭代添加条件  for k, v of map when v.size() &gt; 10</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># when 配合for循环，对象迭代使用</span></span><br><span class="line">array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> array <span class="keyword">when</span> i &gt; <span class="number">2</span></span><br><span class="line">    <span class="built_in">console</span>.log i</span><br><span class="line">map = </span><br><span class="line">	<span class="string">"1"</span>: <span class="number">1</span></span><br><span class="line">    <span class="string">"2"</span>: <span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> key, val <span class="keyword">of</span> map <span class="keyword">when</span> val &gt;= <span class="number">1</span></span><br><span class="line">    <span class="built_in">console</span>.log key</span><br></pre></td></tr></table></figure>
</li>
<li><p>own关键字</p>
</li>
<li><p>while, until 循环，C语言中while与do .. while</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> x &lt;= <span class="number">10</span></span><br><span class="line">    x += <span class="number">1</span></span><br><span class="line">    <span class="built_in">console</span>.log x</span><br><span class="line"><span class="keyword">until</span> x &gt; <span class="number">10</span></span><br><span class="line">	x += <span class="number">1</span></span><br><span class="line">    <span class="built_in">console</span>.log x</span><br></pre></td></tr></table></figure>
</li>
<li><p>列表解析  console.log x for x in array</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以使用类似python语法中列表解析的语法</span></span><br><span class="line">array = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"><span class="built_in">console</span>.log x <span class="keyword">for</span> x <span class="keyword">in</span> array</span><br></pre></td></tr></table></figure>
</li>
<li><p>do关键字在执行代码外包装函数</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建闭包，保留变量作用域</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span> .. <span class="number">5</span>]</span><br><span class="line">    setTimeout -&gt; <span class="built_in">console</span>.log x, <span class="number">1</span> <span class="comment"># 输出5个6，只保留了最后一次大于5的跳出循环的结果</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span> .. <span class="number">5</span>]</span><br><span class="line">    <span class="keyword">do</span> (x) -&gt;</span><br><span class="line">    	setTimeout -&gt; <span class="built_in">console</span>.log x, <span class="number">1</span> <span class="comment"># 输出 1 2 3 4 5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>class 定义类， constructor构造函数，@等同于this</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span></span><br><span class="line">    constructor: <span class="function"><span class="params">(@name, @is_fur)</span> -&gt;</span></span><br><span class="line">    eat: <span class="function">-&gt;</span></span><br><span class="line">        <span class="built_in">console</span>.log @name + <span class="string">"is eating..."</span></span><br><span class="line"><span class="keyword">new</span> Animal(<span class="string">"Dog"</span>, <span class="literal">true</span>).eat() <span class="comment"># Dog is eating</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>@funciton_name 等同于 static函数，即类级函数</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line">    @static_func: <span class="function">-&gt;</span></span><br><span class="line">        <span class="built_in">console</span>.log <span class="string">"static function"</span></span><br><span class="line">Test.static_func()</span><br></pre></td></tr></table></figure>
</li>
<li><p>extends继承关键字</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chicken</span> <span class="keyword">extends</span> <span class="title">Animal</span></span></span><br><span class="line">    constructor: <span class="function"><span class="params">(@eggs)</span> -&gt;</span></span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"Chicken"</span>, <span class="literal">true</span>)</span><br><span class="line">        <span class="built_in">console</span>.log <span class="string">"Chicken constructor..."</span></span><br><span class="line">    egg: <span class="function">-&gt;</span></span><br><span class="line">        @eggs += <span class="number">1</span></span><br><span class="line">        <span class="built_in">console</span>.log <span class="string">"egg's count <span class="subst">#&#123;@eggs&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">hen = <span class="keyword">new</span> Chicken()</span><br><span class="line">hen.eat()</span><br><span class="line">hen.egg()</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># Chicken constructor...</span></span><br><span class="line"><span class="comment"># Chickenis eating...</span></span><br><span class="line"><span class="comment"># egg's count 1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>=&gt; 绑定this的函数</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">    constructor: <span class="function"><span class="params">(@name)</span> -&gt;</span></span><br><span class="line"> 	sayHello: <span class="function">-&gt;</span></span><br><span class="line">        <span class="built_in">console</span>.log <span class="string">"Hello, "</span> + @name</span><br><span class="line"></span><br><span class="line">lilei = <span class="keyword">new</span> Person(<span class="string">"lilei"</span>)</span><br><span class="line">hanmeimei = <span class="keyword">new</span> Person(<span class="string">"hanmeimei"</span>)</span><br><span class="line"><span class="function"><span class="title">log</span> = <span class="params">(cb)</span> -&gt;</span></span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"before calling callback..."</span></span><br><span class="line">    cb()</span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"after called callback..."</span></span><br><span class="line">log(lilei.sayHello)</span><br><span class="line">log(hanmeimei.sayHello)</span><br></pre></td></tr></table></figure>
<p>调用log之后执行cb()后提示出错，Hello, undefined，因为此时把cb传递给log的时候原函数上下文已经丢失</p>
<p>这里需要使用等号箭头的方式，把this也传递进来。修改如下: </p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">    constructor: <span class="function"><span class="params">(@name)</span> -&gt;</span></span><br><span class="line"> 	sayHello: <span class="function">=&gt;</span></span><br><span class="line">        <span class="built_in">console</span>.log <span class="string">"Hello, "</span> + @name</span><br></pre></td></tr></table></figure>
<p>这样使用=&gt;将正确的this绑定并传递，输出就是正确的了。</p>
</li>
</ol>
</div></section></div><div class="container"><ul class="nav"><li>下一篇：<a href="/2017/06/01/正则表达式要点.html">正则表达式要点</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><center class="span">2014-2018 bugcode.</center></div></footer><script src="/script/jquery.min.js"></script><script src="/script/index.js"></script><script src="/script/jquery.min.js"></script><script src="/script/index.js"></script><script src="/script/post.js"></script></body></html>